<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>zhizhen</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="f767091f-d30e-42aa-91e1-0f1700353c44" class="page sans"><header><h1 class="page-title">zhizhen</h1></header><div class="page-body"><hr id="976fdc5b-424c-4d66-a8b4-bd1ab531dd82"/><p id="167f1e89-f150-4e9d-9acf-4950b858755c" class="">
</p><p id="c3551f49-746b-4d43-a699-0c5382d34d8f" class="">
</p><nav id="1f969666-674f-4063-bd3b-fdd5ecba9136" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5258536a-a8c9-4504-b237-fe9c2b1e743d">指针和引用的区别？</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#31683cd4-9aa1-4b8d-85a5-b9f3669d32aa">指针和引用传递的底层原理？</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#beef3035-6e7e-4af1-8fef-0c7bf69b6b95">区别几种指针类型？</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a8f0b88a-770d-4558-a76c-e10b11954377">函数指针？</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d014928d-2074-4ac5-b87c-af3cbc56244c">智能指针</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9e73f141-3478-4e9c-bc86-3e590f0679e5">智能指针的原理？</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d8be5dbe-b4af-4917-be11-610c433a4248">有哪些常用的智能指针？</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#98b7ea5f-e632-4b1e-93da-fc75866fa982">智能指针出现循环引用怎么解决？</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#47fa9f2e-8cb5-41e6-860d-6d3cfb69d979">手写unique_ptr</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#04999e90-cb9d-4674-9595-cc568dace53f">手写shared_ptr</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#83cac531-6565-4bc0-b831-b869661ef60c">智能指针的线程安全问题？</a></div></nav><p id="d3c21268-0fb8-4132-89e4-db0abfdf37fd" class="">
</p><p id="eba03064-6ed8-4705-b28d-4c32c3cd1730" class="">
</p><p id="20725d4b-66b3-45de-9561-0184f20d8c56" class="">
</p><p id="22f60a13-a113-4ac7-838a-e9f14198c2d7" class="">
</p><h3 id="5258536a-a8c9-4504-b237-fe9c2b1e743d" class="">指针和引用的区别？</h3><ul id="1ccfa6dc-d3df-4342-aa73-98728f7380b5" class="bulleted-list"><li>指针是一个变量，存储的是一个地址，引用跟原来的变量实质上是同一个东西，是原变量的别名 </li></ul><ul id="07102bcc-3e03-43f7-91ef-ae11e3f3e62c" class="bulleted-list"><li>指针可以有多级，引用只有一级</li></ul><ul id="66066ffb-2e5b-48f9-b471-5a46500a2f57" class="bulleted-list"><li>指针可以为空，但不存在指向空值的引用</li></ul><ul id="496a8e49-5a4b-4b25-bd23-75f99ec15abe" class="bulleted-list"><li>指针在初始化后可以改变指向，而引用在初始化之后不可再改变 </li></ul><ul id="8d02b6b5-b3d7-4935-b5b2-eaed12652d33" class="bulleted-list"><li>sizeof指针得到的是本指针的大小，sizeof引用得到的是引用所指向变量的大小 </li></ul><ul id="9c93afd0-bd1b-4386-b6e8-30c654e9b551" class="bulleted-list"><li><strong>当把指针作为参数进行传递时，也是将实参的一个拷贝传递给形参，两者指向的地址相同，但不是同一个变量，在函数中改变这个变量的指向不影响实参</strong>，而引用却可以。</li></ul><ul id="4cbb8eea-2d68-48d4-b3ee-792871fd7c8d" class="bulleted-list"><li><strong>引用在声明时必须初始化</strong>；指针声明和定义可以分开，可以先只声明指针变量而不初始化，等用到时再指向具体变量。 </li></ul><p id="c5d1b5ab-105d-4281-b1bc-bc0f0f2d3b6c" class="">
</p><p id="e2effdd7-2945-4174-a92a-eb841c3c74bd" class="">
</p><h3 id="31683cd4-9aa1-4b8d-85a5-b9f3669d32aa" class="">指针和引用传递的底层原理？</h3><p id="b1fb0653-0800-4a76-83da-98a1c54880b7" class=""><strong>引用本身存放的是引用对象的地址</strong>，通俗点理解就是引用就是通过指针来实现的，所以，应用所占的内存大小就是指针的大小。</p><p id="60bd19a4-47a0-44d1-8642-9b698e1242cd" class="">但是 <code>&amp;b</code> 不能获得b本身的地址（假如 <code>int &amp;b=x</code> ），因为编译器会将&amp;b解释为 <code>&amp;(*b) =&amp;x</code> 。</p><p id="efc4adb7-bca0-4e64-9b9a-ffbb104bf046" class="">
</p><p id="0e3bc804-cb05-4e10-a6d0-ede2238f59aa" class="">
</p><h3 id="beef3035-6e7e-4af1-8fef-0c7bf69b6b95" class="">区别几种指针类型？</h3><pre id="a3afb446-8d6e-4e97-8d3d-83192f22dca2" class="code"><code>int *p[10]
int (*p)[10]
int *p(int)
int (*p)(int)</code></pre><p id="5c61b44d-58f8-4c2e-a480-821ca97039c7" class=""><code>int *p[10]</code> ：指针数组，p是一个数组变量，数组大小为10，数组内每个元素都是指向int类型的指针变量</p><p id="f7eb4a7e-6dc9-4514-af13-b68324377b18" class=""><code>int (*p)[10]</code> ：数组指针，p是一个指针变量，指向一个int类型的数组，数组大小是10</p><p id="0b26bd28-de6f-4121-ab04-9038327b01e7" class=""><code>int *p(int)</code> ：函数声明，函数名是p，参数是int类型，返回值是int*类型</p><p id="23c5f2d3-6568-4e8f-9910-9a02b85a8297" class=""><code>int (*p)(int)</code> ：函数指针，指向一个函数，该函数具有int类型参数，返回值是int类型</p><p id="7d29f663-0e9b-44a2-a7a2-031e40e7cfa7" class="">
</p><h3 id="a8f0b88a-770d-4558-a76c-e10b11954377" class="">函数指针？</h3><p id="5c211dce-6037-4941-82a4-1002b7119378" class=""><strong>what is 函数指针？</strong></p><p id="f9286171-ef9b-4c12-9c90-67056da0cf9e" class="">函数指针指向的是特殊的数据类型，函数的类型是由其返回的数据类型和其参数列表共同决定的，而函数的名称则不是其类型的一部分。</p><p id="cdcd35cc-ba05-4139-8c01-5332ad2c174e" class="">函数与数据项相似，函数也有地址。我们希望在同一个函数中通过使用相同的形参在不同的时间使用产生不同的效果。</p><p id="b246e582-1693-44be-b2a0-4a1c7dbf7805" class=""><strong>声明方法</strong></p><p id="4352c7ca-084b-456b-951b-478c2abfadd3" class="">int (*pf)(const int&amp;, const int&amp;);</p><p id="34ca2f1a-7b22-414c-a2be-41cf558cb69f" class="">
</p><p id="82e7f497-e032-4486-833a-f5450b1f8c47" class="">
</p><h2 id="d014928d-2074-4ac5-b87c-af3cbc56244c" class="">智能指针</h2><h3 id="9e73f141-3478-4e9c-bc86-3e590f0679e5" class="">智能指针的原理？</h3><p id="31f8cfb5-1d6b-495c-8e08-fc97a9fccf5b" class="">智能指针是一个类，用来存储指向动态分配对象的指针，负责自动释放动态分配的对象，<strong>防止堆内存泄漏</strong>。动态分配的资源，交给一个类对象去管理，<span style="border-bottom:0.05em solid">当类对象声明周期结束时，自动调用析构函数释放资源。</span></p><p id="2b10f3a9-2728-4b40-8566-238e23ead2ed" class=""><strong>基本思想：将基本类型指针封装为类对象指针（这个类肯定是个模板，以适应不同基本类型的需求），并在析构函数里编写delete语句删除指针指向的内存空间。</strong></p><p id="96b37cf8-29fc-412d-bdf1-0dafa01eef6c" class="">不管是正常终止，还是由于出现了异常而终止，本地变量都将自动从栈内存中删除。</p><p id="de2535eb-c713-4def-a354-91030b5e8feb" class="">
</p><h3 id="d8be5dbe-b4af-4917-be11-610c433a4248" class="">有哪些常用的智能指针？</h3><ul id="bb9fd04e-4083-443b-b96d-2dec5114b0ca" class="bulleted-list"><li>auto_ptr（98中的，已弃用，可用unique_ptr替代）<ul id="ed70ca33-9107-4f6b-ae10-06197911ffe9" class="bulleted-list"><li>auto_ptr的出现，主要是为了解决“<strong>有异常抛出时发生内存泄漏</strong>”的问题；抛出异常，将导致指针p所指向的空间得不到释放而导致内存泄漏</li></ul><ul id="0fb349c8-1478-4113-bad8-15776543134d" class="bulleted-list"><li>auto_ptr构造时取得某个对象的控制权，在析构时释放该对象。我们<strong>实际上是创建一个auto_ptr类型的局部对象，该局部对象析构时，会将自身所拥有的指针空间释放，所以不会有内存泄漏（所有智能指针的原理？）</strong></li></ul></li></ul><ul id="5042f707-386c-40b7-a48a-bd30afbcde4c" class="bulleted-list"><li>unique_ptr<p id="5a7807e6-658d-45a9-b47c-834bbfa5d2cf" class="">auto_ptr是可以说你随便赋值，但赋值完了之后原来的对象就不知不觉的报废。搞得你莫名其妙。而<strong>unique就干脆不让你可以随便去复制，赋值（更安全，通过禁用拷贝构造函数和=操作符，=delete</strong>）。如果实在想传个值就哪里，显式的说明内存转移std:move一下。然后这样传值完了之后，之前的对象也同样报废了。只不过整个move你让明显的知道这样操作后会导致之前的unique_ptr对象失效。</p></li></ul><ul id="9fef30c3-ca42-4b25-bd8f-5744f18524b6" class="bulleted-list"><li>shared_ptr<p id="a12229ab-5e35-4d99-a4bb-f9d0fa13f225" class="">引进了一个计数器shared_count，用来表示当前有多少个智能指针对象共享指针指向的内存块（因为要共享，比unique_ptr多了这个计数器）</p></li></ul><ul id="1664f8b6-2714-492a-b97c-d71001dce148" class="bulleted-list"><li>weak_ptr<p id="0e0e4687-0489-4098-92ad-9157007989f0" class="">为了解决shared_ptr循环引用的问题</p></li></ul><p id="6c95e4f8-2527-4e60-9d75-fc3b20a2d404" class="">
</p><p id="445b9ebd-b5f1-4d24-92e5-0d583e7c6cdb" class="">
</p><h3 id="98b7ea5f-e632-4b1e-93da-fc75866fa982" class="">智能指针出现循环引用怎么解决？</h3><p id="53ba50ff-8bfc-4696-8b8d-bb200c295103" class="">循环引用：两个对象互相使用一个shared_ptr成员变量指向对方。</p><p id="c7ccc9a7-154e-4e48-831f-f0ff3c44f04f" class="">弱指针用于专门解决shared_ptr循环引用的问题，weak_ptr不会修改引用计数，即其存在与否并不影响 对象的引用计数器。弱引用并不对对象的内存进行管理，在功能上类似于普通指针，然而一个比较大的区别是，弱引用能检测到所管理的对象是否已经被释放，从而避免访问非法内存。</p><p id="fe081100-9bf1-46a4-81d9-da026f950b14" class="">
</p><p id="3827ba10-c5ff-47e1-98ff-c40b250d2ca8" class="">
</p><h3 id="47fa9f2e-8cb5-41e6-860d-6d3cfb69d979" class="">手写unique_ptr</h3><pre id="6facbabc-ce18-48b8-842d-84a3b1a4ff93" class="code"><code>template&lt;class T&gt;
class UniquePtr
{
public:
		UniquePtr(T* ptr = NULL): _ptr(ptr){}

		UniquePtr(UniquePtr &amp;&amp;p): _ptr(p._ptr)
		{
				p._ptr = nullptr;
		}

		~UniquePtr()
		{
				if (_ptr!=nullptr)
				{
						delete _ptr;
						_ptr = nullptr;
				}
		}
		
		UniquePtr(const UniquePtr&amp; s) = delete;

		UniquePtr&lt;T&gt;&amp; operator=(const UniquePtr&amp; s) = delete;

public:
		T&amp; operator*()
		{
				return *_ptr;
		}

		T* operator-&gt;()
		{
				return _ptr;
		}

		UniquePtr&amp; operator=(UniquePtr &amp;&amp;p)
		{
				std::swap(_ptr,p._ptr);
				return *this;
		}
		

private:
		T* _ptr;
}</code></pre><p id="018638aa-4a05-4e8a-921c-40d8fe79c9cd" class="">
</p><h3 id="04999e90-cb9d-4674-9595-cc568dace53f" class="">手写shared_ptr</h3><pre id="a302c5d0-2a6e-4240-a31b-653e06d93fff" class="code"><code>template&lt;class T&gt;
class SharedPtr
{
public:
		SharedPtr(T* ptr = NULL):_ptr(ptr),_pcount(new int(1)){}
		
		SharedPtr(const SharedPtr&amp; s):_ptr(s._ptr),_pcount(s._pcount)
		{
				++(*_pcount);
		}

		SharedPtr&lt;T&gt;&amp; operator=(const SharedPtr&amp; s)
		{
				if (this != &amp;s)
				{
						--(*_pcount);
						if (*_pcount == 0)
						{
								delete _ptr;
								delete _pcount;
						}
						_ptr = s._ptr;
						_pcount = s._pcount;
						++(*_pcount);
				}
				return *this;
		}

		T&amp; operator*()
		{
				return *(this-&gt;_ptr);
		}

		T* operator-&gt;()
		{
				return this-&gt;_ptr;
		}

		~SharedPtr()
		{
				--(*_pcount);
				if (*_pcount == 0)
				{
						delete _ptr;
						_ptr = NULL;
						delete _pcount;
						_pcount = NULL;
				}
		}

private:
		T* _ptr;
		int* _pcount;
}</code></pre><p id="61d6b1f3-968b-4fb8-a7b6-c1c6bc63d514" class="">
</p><p id="b370d63a-bfce-40f1-9c90-4c581b4524d7" class="">
</p><h3 id="83cac531-6565-4bc0-b831-b869661ef60c" class="">智能指针的线程安全问题？</h3><figure id="5f90858b-7a25-45f9-9520-a0d8ed45568e"><a href="https://www.jianshu.com/p/cb3e574eee5f" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">智能指针的线程安全</div><div class="bookmark-description">为什么多线程读写 shared_ptr 要加锁？ boost官方文档 shared_ptr_thread_safety 智能指针包括一个实际数据指针和一个引用计数指针，这两个操作不是一个指令可以完成的，因此多线程环境下，势必有问题。 根据 boost官方文档 shared_ptr_thread_safety 有如下结论： 同一个shared_ptr被多个线程读，是线程安全的； 同一个shared_ptr被多个线程写，不是线程安全的； 共享引用计数的不同的shared_ptr被多个线程写，是线程安全的。 Examples: shared_ptr p(new int(42)); Code Example 4. Reading a shared_ptr from two threads，线程安全 // thread A shared_ptr p2(p); // reads p // thread B shared_ptr p3(p); // OK, multiple reads are safe Code Example 5.</div></div><div class="bookmark-href"><img src="data:image/vnd.microsoft.icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAABILAAASCwAAAAAAAAAAAAAAAAAASWTtHEhh5qZIYObmSGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDm5khh5qZJZO0cAAAAAElk7RxIYeXtSGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hh5e1JZO0cSGHmpkhg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hh5qZIYObmSGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDm5khg5f9IYOX/SGDl/0hg5f9IYOX/ipnu/5qn8P9qfen/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/TWTl/5qn8P+grfH/nKnx/3iJ6/9JYeX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/Cyvb///////T2/f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f99juz//////////////////////8vS9/9LY+X/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/8LK9v///////f3+/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/2l96f+hrfH/o6/x/9HX+P///////////5Gg7/9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/wsr2///////9/f7/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/Vmzn////////////usP1/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/Cyvb///////39/v9IYOX/SGDl/46d7v/+/v7//v7+//7+/v/+/v7//v7+//7+/v/+/v7/8fP9/8LK9v9keOn/SGDl/0hg5f9JYeX///////////+9xvX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/8LK9v///////f3+/0hg5f9IYOX/j53v////////////ydD3/6ax8v+msfL/prHy/6248//t8Pz//////+/x/P9dcuj/SGDl/0lh5f///////////73G9f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/wsr2///////9/f7/SGDl/0hg5f+Pne////////////+RoO//SGDl/0hg5f9IYOX/SGDl/5Kg7////////////56q8f9IYOX/SWHl////////////vcb1/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/Cyvb///////39/v9IYOX/SGDl/4+d7////////////5Oh7/9JYeX/SWHl/0lh5f9JYeX/h5fu////////////ucL1/0hg5f9JYeX///////////+9xvX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/8LK9v///////f3+/0hg5f9IYOX/j53v//////////////////////////////////////////////////////+4wfX/SGDl/0lh5f///////////73G9f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/wsr2///////9/f7/SGDl/0hg5f+Pne/////////////g5Pr/xs32/8bN9v/Gzfb/xs32/9jd+f///////////7fB9P9IYOX/SWHl////////////vcb1/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/Cyvb///////39/v9IYOX/SGDl/4+d7////////////5uo8P9IYOX/SGDl/0hg5f9IYOX/gZHt////////////t8D0/0hg5f9JYeX///////////+9xvX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/8LK9v///////f3+/0hg5f9IYOX/j53v////////////m6jw/0hg5f9IYOX/SGDl/0hg5f+Bke3///////////+2wPT/SGDl/0lh5f///////////73G9f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/wsr2///////9/f7/SGDl/0hg5f+Pne///////////////////////////////////////////////////////7W/9P9IYOX/SWHl////////////vcb1/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/Cyvb///////39/v9IYOX/SGDl/4WV7f/l6Pv/5ej7/+Xo+//l6Pv/5ej7/+Xo+//l6Pv/5ej7/+Xo+//l6Pv/pbHy/0hg5f9JYeX///////////+9xvX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/2h86f96i+z/eozs/7S+9P/K0ff/p7Ly/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0lh5f///////////73G9f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9gdej///////////+8xfX/bYDq/5il8P+YpfD/mKXw/5il8P+YpfD/mKXw/5il8P+YpfD/mKXw/5il8P+YpfD/mafw////////////vcb1/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/7zF9f//////9fb9/1906P/P1fj///////////////////////////////////////////////////////////////////////////+9xvX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/oK3x/1Rq5v9/kOz///////z9/v99juz/SGDl/6u28//AyPb/wMj2/8DI9v/K0ff/4eX6/8DI9v/AyPb/wMj2/8DI9v/AyPb/wMj2/8DI9v/AyPb/wMj2/5Wj8P9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f/8/f7/9fb9/6248/9Uaub/TWTl/0hg5f9/kOz/6Ov7/+Hl+v9ccuf/SGDl/3WH6///////vMX1/1Fo5v9IYOX/SGDl/0hg5f/L0vf/9/j9/8TL9v9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/6Ov8f/6+/7//////87U+P9PZub/SGDl/7rD9f//////9fb9/05l5f9IYOX/YXXo/+7w/P//////3eL6/1lu5/9IYOX/TWTl//f4/f//////rbjz/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/22A6v/09v3//////9fc+f+Zp/D/9vf9///////Y3fn/j53v/5Si7/+Wo/D/Znrp/93i+v//////3uL6/5mn8P+yvPT///////////+yvPT/mafw/5mn8P96i+z/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/32O7P////////////////////////////////////////////////+cqfH/X3To//r7/v////////////////////////////////////////////Hz/f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/8zT9////////////2l86f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/usP1////////////iJju/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/jJvu////////////kZ/v/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9/kOz///////////+eqvH/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5uZIYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9KYeX/SmHl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYObmSGHmpkhg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hh5qZJZO0cSGHl7Uhg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYeXtSWTtHAAAAABJZO0cSGHmpkhg5uZIYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYOX/SGDl/0hg5f9IYObmSGHmpklk7RwAAAAAgAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAE=" class="icon bookmark-icon"/>https://www.jianshu.com/p/cb3e574eee5f</div></div><img src="https://upload.jianshu.io/users/upload_avatars/5021195/f39ea5e5-1b0b-4dbf-9ff4-fa5468046805.jpg" class="bookmark-image"/></a></figure><p id="8d5f408d-e5f0-47ff-8073-67ab49babc3c" class="">
</p></div></article></body></html>